<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use Illuminate\Support\Str;
use App\Models\User;
use App\Models\Station;
use App\Models\Route;
use App\Models\Stop;
use App\Models\RouteStopOrder;
use App\Models\RouteFare;
use App\Models\VehicleType;
use App\Models\Vehicle;
use App\Models\Trip;
use Illuminate\Support\Facades\Hash;
use Carbon\Carbon;

class InitialSetupSeeder extends Seeder
{
    public function run(): void
    {
        // ==========================================
        // UTILISATEURS
        // ==========================================
        $admin = User::create([
            'name' => 'Administrateur',
            'email' => 'admin@transport.ci',
            'telephone' => '+225 0701234567',
            'password' => Hash::make('password'),
            'role' => 'admin',
        ]);

        $supervisor = User::create([
            'name' => 'Superviseur Gare',
            'email' => 'superviseur@transport.ci',
            'telephone' => '+225 0702345678',
            'password' => Hash::make('password'),
            'role' => 'supervisor',
        ]);

        $seller1 = User::create([
            'name' => 'Guichetier Abidjan',
            'email' => 'guichet.abidjan@transport.ci',
            'telephone' => '+225 0703456789',
            'password' => Hash::make('password'),
            'role' => 'seller',
        ]);

        $seller2 = User::create([
            'name' => 'Guichetier Korhogo',
            'email' => 'guichet.korhogo@transport.ci',
            'telephone' => '+225 0704567890',
            'password' => Hash::make('password'),
            'role' => 'seller',
        ]);

        // ==========================================
        // STATIONS AVEC COORDONNÃ‰ES GPS RÃ‰ELLES
        // ==========================================
        $abidjan = Station::create([
            'name' => 'Abidjan - Gare d\'AdjamÃ©',
            'code' => 'ABJ',
            'city' => 'Abidjan',
            'address' => 'Gare RoutiÃ¨re d\'AdjamÃ©, Abidjan',
            'latitude' => 5.3600,
            'longitude' => -4.0083,
            'active' => true
        ]);

        $yamoussoukro = Station::create([
            'name' => 'Yamoussoukro',
            'code' => 'YAM',
            'city' => 'Yamoussoukro',
            'address' => 'Gare RoutiÃ¨re de Yamoussoukro',
            'latitude' => 6.8276,
            'longitude' => -5.2893,
            'active' => true
        ]);

        $bouake = Station::create([
            'name' => 'BouakÃ©',
            'code' => 'BKE',
            'city' => 'BouakÃ©',
            'address' => 'Gare RoutiÃ¨re de BouakÃ©',
            'latitude' => 7.6944,
            'longitude' => -5.0300,
            'active' => true
        ]);

        $katiola = Station::create([
            'name' => 'Katiola',
            'code' => 'KAT',
            'city' => 'Katiola',
            'address' => 'Gare RoutiÃ¨re de Katiola',
            'latitude' => 8.1372,
            'longitude' => -5.0978,
            'active' => true
        ]);

        $korhogo = Station::create([
            'name' => 'Korhogo',
            'code' => 'KOR',
            'city' => 'Korhogo',
            'address' => 'Gare RoutiÃ¨re de Korhogo',
            'latitude' => 9.4580,
            'longitude' => -5.6294,
            'active' => true
        ]);

        $adzope = Station::create([
            'name' => 'AdzopÃ©',
            'code' => 'ADZ',
            'city' => 'AdzopÃ©',
            'address' => 'Gare RoutiÃ¨re d\'AdzopÃ©',
            'latitude' => 6.1069,
            'longitude' => -3.8589,
            'active' => true
        ]);

        $abengourou = Station::create([
            'name' => 'Abengourou',
            'code' => 'ABG',
            'city' => 'Abengourou',
            'address' => 'Gare RoutiÃ¨re d\'Abengourou',
            'latitude' => 7.1333,
            'longitude' => -3.2000,
            'active' => true
        ]);

        $agnibilekrou = Station::create([
            'name' => 'AgnibilÃ©krou',
            'code' => 'AGL',
            'city' => 'AgnibilÃ©krou',
            'address' => 'Gare RoutiÃ¨re d\'AgnibilÃ©krou',
            'latitude' => 7.1333,
            'longitude' => -3.2000,
            'active' => true
        ]);

        $bondoukou = Station::create([
            'name' => 'Bondoukou',
            'code' => 'BDK',
            'city' => 'Bondoukou',
            'address' => 'Gare RoutiÃ¨re de Bondoukou',
            'latitude' => 8.0403,
            'longitude' => -2.8000,
            'active' => true
        ]);

        // ==========================================
        // ARRÃŠTS (STOPS) POUR CHAQUE STATION
        // ==========================================
        $stopAbidjan = Stop::create(['name' => 'Abidjan - AdjamÃ©', 'station_id' => $abidjan->id]);
        $stopYamoussoukro = Stop::create(['name' => 'Yamoussoukro Centre', 'station_id' => $yamoussoukro->id]);
        $stopBouake = Stop::create(['name' => 'BouakÃ© Centre', 'station_id' => $bouake->id]);
        $stopKatiola = Stop::create(['name' => 'Katiola Centre', 'station_id' => $katiola->id]);
        $stopKorhogo = Stop::create(['name' => 'Korhogo Centre', 'station_id' => $korhogo->id]);
        $stopAdzope = Stop::create(['name' => 'AdzopÃ© Centre', 'station_id' => $adzope->id]);
        $stopAbengourou = Stop::create(['name' => 'Abengourou Centre', 'station_id' => $abengourou->id]);
        $stopAgnibilekrou = Stop::create(['name' => 'AgnibilÃ©krou Centre', 'station_id' => $agnibilekrou->id]);
        $stopBondoukou = Stop::create(['name' => 'Bondoukou Centre', 'station_id' => $bondoukou->id]);

        // ==========================================
        // TYPES DE VÃ‰HICULES (6 types: 15, 30, 50x2, 50x3, 70x2, 70x3)
        // ==========================================
        
        // Minibus 15 places (2+1, 1 porte)
        $minibus15 = VehicleType::create([
            'name' => 'Minibus 15 places',
            'seat_count' => 15,
            'seat_configuration' => '2+1',
            'door_count' => 1,
            'door_positions' => [1],
            'seat_map' => [
                'rows' => 5,
                'seats_per_row' => 3,
                'aisle_position' => 2,
                'layout' => '2+1'
            ],
            'svg_template_path' => 'svg/vehicles/minibus_15.svg'
        ]);

        // Bus 30 places (2+2, 2 portes)
        $bus30 = VehicleType::create([
            'name' => 'Bus 30 places',
            'seat_count' => 30,
            'seat_configuration' => '2+2',
            'door_count' => 2,
            'door_positions' => [1, 16],
            'seat_map' => [
                'rows' => 8,
                'seats_per_row' => 4,
                'aisle_position' => 2,
                'layout' => '2+2'
            ],
            'svg_template_path' => 'svg/vehicles/bus_30.svg'
        ]);

        // Bus 50 places configuration 2+2 (2 portes)
        $bus50_2x2 = VehicleType::create([
            'name' => 'Bus 50 places (2+2)',
            'seat_count' => 50,
            'seat_configuration' => '2+2',
            'door_count' => 2,
            'door_positions' => [1, 26],
            'seat_map' => [
                'rows' => 13,
                'seats_per_row' => 4,
                'aisle_position' => 2,
                'layout' => '2+2'
            ],
            'svg_template_path' => 'svg/vehicles/bus_50_2x2.svg'
        ]);

        // Bus 50 places configuration 3+2 (2 portes)
        $bus50_3x2 = VehicleType::create([
            'name' => 'Bus 50 places (3+2)',
            'seat_count' => 50,
            'seat_configuration' => '3+2',
            'door_count' => 2,
            'door_positions' => [1, 26],
            'seat_map' => [
                'rows' => 10,
                'seats_per_row' => 5,
                'aisle_position' => 3,
                'layout' => '3+2'
            ],
            'svg_template_path' => 'svg/vehicles/bus_50_3x2.svg'
        ]);

        // Bus 70 places configuration 2+2 (3 portes)
        $bus70_2x2 = VehicleType::create([
            'name' => 'Bus 70 places (2+2)',
            'seat_count' => 70,
            'seat_configuration' => '2+2',
            'door_count' => 3,
            'door_positions' => [1, 30, 55],
            'seat_map' => [
                'rows' => 18,
                'seats_per_row' => 4,
                'aisle_position' => 2,
                'layout' => '2+2'
            ],
            'svg_template_path' => 'svg/vehicles/bus_70_2x2.svg'
        ]);

        // Bus 70 places configuration 3+2 (3 portes)
        $bus70_3x2 = VehicleType::create([
            'name' => 'Bus 70 places (3+2)',
            'seat_count' => 70,
            'seat_configuration' => '3+2',
            'door_count' => 3,
            'door_positions' => [1, 30, 55],
            'seat_map' => [
                'rows' => 14,
                'seats_per_row' => 5,
                'aisle_position' => 3,
                'layout' => '3+2'
            ],
            'svg_template_path' => 'svg/vehicles/bus_70_3x2.svg'
        ]);

        // ==========================================
        // VÃ‰HICULES
        // ==========================================
        $vehiclesMini = [];
        for ($i = 1; $i <= 3; $i++) {
            $vehiclesMini[] = Vehicle::create([
                'identifier' => 'MIN-' . str_pad($i, 3, '0', STR_PAD_LEFT),
                'maker' => 'Toyota Hiace',
                'vehicle_type_id' => $minibus15->id,
                'seat_count' => 15
            ]);
        }

        $vehiclesBus30 = [];
        for ($i = 1; $i <= 4; $i++) {
            $vehiclesBus30[] = Vehicle::create([
                'identifier' => 'B30-' . str_pad($i, 3, '0', STR_PAD_LEFT),
                'maker' => 'Mercedes-Benz Sprinter',
                'vehicle_type_id' => $bus30->id,
                'seat_count' => 30
            ]);
        }

        $vehiclesBus50_2x2 = [];
        for ($i = 1; $i <= 5; $i++) {
            $vehiclesBus50_2x2[] = Vehicle::create([
                'identifier' => 'B50-2X2-' . str_pad($i, 3, '0', STR_PAD_LEFT),
                'maker' => 'Mercedes-Benz Tourismo',
                'vehicle_type_id' => $bus50_2x2->id,
                'seat_count' => 50
            ]);
        }

        $vehiclesBus50_3x2 = [];
        for ($i = 1; $i <= 5; $i++) {
            $vehiclesBus50_3x2[] = Vehicle::create([
                'identifier' => 'B50-3X2-' . str_pad($i, 3, '0', STR_PAD_LEFT),
                'maker' => 'Volvo 9700',
                'vehicle_type_id' => $bus50_3x2->id,
                'seat_count' => 50
            ]);
        }

        $vehiclesBus70_2x2 = [];
        for ($i = 1; $i <= 4; $i++) {
            $vehiclesBus70_2x2[] = Vehicle::create([
                'identifier' => 'B70-2X2-' . str_pad($i, 3, '0', STR_PAD_LEFT),
                'maker' => 'Scania Interlink',
                'vehicle_type_id' => $bus70_2x2->id,
                'seat_count' => 70
            ]);
        }

        $vehiclesBus70_3x2 = [];
        for ($i = 1; $i <= 4; $i++) {
            $vehiclesBus70_3x2[] = Vehicle::create([
                'identifier' => 'B70-3X2-' . str_pad($i, 3, '0', STR_PAD_LEFT),
                'maker' => 'MAN Lion Coach',
                'vehicle_type_id' => $bus70_3x2->id,
                'seat_count' => 70
            ]);
        }

        // ==========================================
        // TRAJET 1: ABIDJAN â†’ KORHOGO (525 km, 5 arrÃªts)
        // ==========================================
        $routeAbidjanKorhogo = Route::create([
            'name' => 'Abidjan â†’ Korhogo',
            'origin_station_id' => $abidjan->id,
            'destination_station_id' => $korhogo->id,
            'active' => true
        ]);

        // Ordre des arrÃªts
        RouteStopOrder::create(['route_id' => $routeAbidjanKorhogo->id, 'stop_id' => $stopAbidjan->id, 'stop_index' => 0]);
        RouteStopOrder::create(['route_id' => $routeAbidjanKorhogo->id, 'stop_id' => $stopYamoussoukro->id, 'stop_index' => 1]);
        RouteStopOrder::create(['route_id' => $routeAbidjanKorhogo->id, 'stop_id' => $stopBouake->id, 'stop_index' => 2]);
        RouteStopOrder::create(['route_id' => $routeAbidjanKorhogo->id, 'stop_id' => $stopKatiola->id, 'stop_index' => 3]);
        RouteStopOrder::create(['route_id' => $routeAbidjanKorhogo->id, 'stop_id' => $stopKorhogo->id, 'stop_index' => 4]);

        // Tarifs (environ 20 FCFA/km)
        RouteFare::create(['route_id' => $routeAbidjanKorhogo->id, 'from_stop_id' => $stopAbidjan->id, 'to_stop_id' => $stopYamoussoukro->id, 'amount' => 5000]); // 240km
        RouteFare::create(['route_id' => $routeAbidjanKorhogo->id, 'from_stop_id' => $stopAbidjan->id, 'to_stop_id' => $stopBouake->id, 'amount' => 7000]); // 335km
        RouteFare::create(['route_id' => $routeAbidjanKorhogo->id, 'from_stop_id' => $stopAbidjan->id, 'to_stop_id' => $stopKatiola->id, 'amount' => 9000]); // 425km
        RouteFare::create(['route_id' => $routeAbidjanKorhogo->id, 'from_stop_id' => $stopAbidjan->id, 'to_stop_id' => $stopKorhogo->id, 'amount' => 11000]); // 525km
        RouteFare::create(['route_id' => $routeAbidjanKorhogo->id, 'from_stop_id' => $stopYamoussoukro->id, 'to_stop_id' => $stopBouake->id, 'amount' => 2000]); // 95km
        RouteFare::create(['route_id' => $routeAbidjanKorhogo->id, 'from_stop_id' => $stopYamoussoukro->id, 'to_stop_id' => $stopKatiola->id, 'amount' => 4000]); // 185km
        RouteFare::create(['route_id' => $routeAbidjanKorhogo->id, 'from_stop_id' => $stopYamoussoukro->id, 'to_stop_id' => $stopKorhogo->id, 'amount' => 6000]); // 285km
        RouteFare::create(['route_id' => $routeAbidjanKorhogo->id, 'from_stop_id' => $stopBouake->id, 'to_stop_id' => $stopKatiola->id, 'amount' => 2000]); // 90km
        RouteFare::create(['route_id' => $routeAbidjanKorhogo->id, 'from_stop_id' => $stopBouake->id, 'to_stop_id' => $stopKorhogo->id, 'amount' => 4000]); // 190km
        RouteFare::create(['route_id' => $routeAbidjanKorhogo->id, 'from_stop_id' => $stopKatiola->id, 'to_stop_id' => $stopKorhogo->id, 'amount' => 2000]); // 100km

        // ==========================================
        // TRAJET 2: ABIDJAN â†’ BONDOUKOU (340 km, 5 arrÃªts incluant Abengourou)
        // ==========================================
        $routeAbidjanBondoukou = Route::create([
            'name' => 'Abidjan â†’ Bondoukou',
            'origin_station_id' => $abidjan->id,
            'destination_station_id' => $bondoukou->id,
            'active' => true
        ]);

        // Ordre des arrÃªts
        RouteStopOrder::create(['route_id' => $routeAbidjanBondoukou->id, 'stop_id' => $stopAbidjan->id, 'stop_index' => 0]);
        RouteStopOrder::create(['route_id' => $routeAbidjanBondoukou->id, 'stop_id' => $stopAdzope->id, 'stop_index' => 1]);
        RouteStopOrder::create(['route_id' => $routeAbidjanBondoukou->id, 'stop_id' => $stopAbengourou->id, 'stop_index' => 2]);
        RouteStopOrder::create(['route_id' => $routeAbidjanBondoukou->id, 'stop_id' => $stopAgnibilekrou->id, 'stop_index' => 3]);
        RouteStopOrder::create(['route_id' => $routeAbidjanBondoukou->id, 'stop_id' => $stopBondoukou->id, 'stop_index' => 4]);

        // Tarifs
        RouteFare::create(['route_id' => $routeAbidjanBondoukou->id, 'from_stop_id' => $stopAbidjan->id, 'to_stop_id' => $stopAdzope->id, 'amount' => 2500]); // 105km
        RouteFare::create(['route_id' => $routeAbidjanBondoukou->id, 'from_stop_id' => $stopAbidjan->id, 'to_stop_id' => $stopAbengourou->id, 'amount' => 4000]); // 180km
        RouteFare::create(['route_id' => $routeAbidjanBondoukou->id, 'from_stop_id' => $stopAbidjan->id, 'to_stop_id' => $stopAgnibilekrou->id, 'amount' => 5500]); // 260km
        RouteFare::create(['route_id' => $routeAbidjanBondoukou->id, 'from_stop_id' => $stopAbidjan->id, 'to_stop_id' => $stopBondoukou->id, 'amount' => 7000]); // 340km
        RouteFare::create(['route_id' => $routeAbidjanBondoukou->id, 'from_stop_id' => $stopAdzope->id, 'to_stop_id' => $stopAbengourou->id, 'amount' => 1500]); // 75km
        RouteFare::create(['route_id' => $routeAbidjanBondoukou->id, 'from_stop_id' => $stopAdzope->id, 'to_stop_id' => $stopAgnibilekrou->id, 'amount' => 3000]); // 155km
        RouteFare::create(['route_id' => $routeAbidjanBondoukou->id, 'from_stop_id' => $stopAdzope->id, 'to_stop_id' => $stopBondoukou->id, 'amount' => 4500]); // 235km
        RouteFare::create(['route_id' => $routeAbidjanBondoukou->id, 'from_stop_id' => $stopAbengourou->id, 'to_stop_id' => $stopAgnibilekrou->id, 'amount' => 1500]); // 80km
        RouteFare::create(['route_id' => $routeAbidjanBondoukou->id, 'from_stop_id' => $stopAbengourou->id, 'to_stop_id' => $stopBondoukou->id, 'amount' => 3000]); // 160km
        RouteFare::create(['route_id' => $routeAbidjanBondoukou->id, 'from_stop_id' => $stopAgnibilekrou->id, 'to_stop_id' => $stopBondoukou->id, 'amount' => 1500]); // 80km

        // ==========================================
        // VOYAGES (TRIPS) - Mix de seat_assignment et bulk
        // ==========================================
        $today = Carbon::today();
        
        // Voyages Abidjan â†’ Korhogo (Bus 70 places)
        Trip::create([
            'route_id' => $routeAbidjanKorhogo->id,
            'vehicle_id' => $vehiclesBus70_3x2[0]->id,
            'departure_at' => $today->copy()->setTime(6, 0),
            'status' => 'scheduled',
            'booking_type' => 'seat_assignment'
        ]);

        Trip::create([
            'route_id' => $routeAbidjanKorhogo->id,
            'vehicle_id' => $vehiclesBus70_2x2[0]->id,
            'departure_at' => $today->copy()->setTime(10, 0),
            'status' => 'scheduled',
            'booking_type' => 'seat_assignment'
        ]);

        Trip::create([
            'route_id' => $routeAbidjanKorhogo->id,
            'vehicle_id' => $vehiclesBus70_3x2[1]->id,
            'departure_at' => $today->copy()->setTime(14, 0),
            'status' => 'scheduled',
            'booking_type' => 'bulk' // Mode en vrac
        ]);

        Trip::create([
            'route_id' => $routeAbidjanKorhogo->id,
            'vehicle_id' => $vehiclesBus70_2x2[1]->id,
            'departure_at' => $today->copy()->setTime(18, 0),
            'status' => 'scheduled',
            'booking_type' => 'seat_assignment'
        ]);

        // Voyages Abidjan â†’ Bondoukou (Bus 50 places)
        Trip::create([
            'route_id' => $routeAbidjanBondoukou->id,
            'vehicle_id' => $vehiclesBus50_3x2[0]->id,
            'departure_at' => $today->copy()->setTime(7, 0),
            'status' => 'scheduled',
            'booking_type' => 'seat_assignment'
        ]);

        Trip::create([
            'route_id' => $routeAbidjanBondoukou->id,
            'vehicle_id' => $vehiclesBus50_2x2[0]->id,
            'departure_at' => $today->copy()->setTime(12, 0),
            'status' => 'scheduled',
            'booking_type' => 'seat_assignment'
        ]);

        Trip::create([
            'route_id' => $routeAbidjanBondoukou->id,
            'vehicle_id' => $vehiclesBus50_3x2[1]->id,
            'departure_at' => $today->copy()->setTime(16, 0),
            'status' => 'scheduled',
            'booking_type' => 'bulk' // Mode en vrac
        ]);

        // Voyages pour demain
        $tomorrow = Carbon::tomorrow();
        
        Trip::create([
            'route_id' => $routeAbidjanKorhogo->id,
            'vehicle_id' => $vehiclesBus70_3x2[2]->id,
            'departure_at' => $tomorrow->copy()->setTime(6, 0),
            'status' => 'scheduled',
            'booking_type' => 'seat_assignment'
        ]);

        Trip::create([
            'route_id' => $routeAbidjanBondoukou->id,
            'vehicle_id' => $vehiclesBus50_2x2[1]->id,
            'departure_at' => $tomorrow->copy()->setTime(7, 30),
            'status' => 'scheduled',
            'booking_type' => 'seat_assignment'
        ]);

        $this->command->info('âœ… Seeder terminÃ© avec succÃ¨s!');
        $this->command->info('ðŸ“Š Statistiques:');
        $this->command->info('   - Utilisateurs: ' . User::count());
        $this->command->info('   - Stations: ' . Station::count());
        $this->command->info('   - Types de vÃ©hicules: ' . VehicleType::count());
        $this->command->info('   - VÃ©hicules: ' . Vehicle::count());
        $this->command->info('   - Routes: ' . Route::count());
        $this->command->info('   - Voyages: ' . Trip::count());
    }
}
